(()=>{var a={};a.id=5360,a.ids=[5360],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:a=>{"use strict";a.exports=require("punycode")},21016:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>U,patchFetch:()=>T,routeModule:()=>P,serverHooks:()=>S,workAsyncStorage:()=>Q,workUnitAsyncStorage:()=>R});var d,e={};c.r(e),c.d(e,{POST:()=>O});var f=c(96559),g=c(48088),h=c(37719),i=c(26191),j=c(81289),k=c(261),l=c(92603),m=c(39893),n=c(14823),o=c(47220),p=c(66946),q=c(47912),r=c(99786),s=c(46143),t=c(86439),u=c(43365),v=c(32190),w=c(97877),x=c(56621),y="basil",z="https://js.stripe.com",A="".concat(z,"/").concat(y,"/stripe.js"),B=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,C=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,D=function(){for(var a=document.querySelectorAll('script[src^="'.concat(z,'"]')),b=0;b<a.length;b++){var c,d=a[b];if(c=d.src,B.test(c)||C.test(c))return d}return null},E=function(a){var b=a&&!a.advancedFraudSignals?"?advancedFraudSignals=false":"",c=document.createElement("script");c.src="".concat(A).concat(b);var d=document.head||document.body;if(!d)throw Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return d.appendChild(c),c},F=function(a,b){a&&a._registerWrapper&&a._registerWrapper({name:"stripe-js",version:"7.5.0",startTime:b})},G=null,H=null,I=null,J=function(a,b,c){if(null===a)return null;var d,e=b[0].match(/^pk_test/),f=3===(d=a.version)?"v3":d;e&&f!==y&&console.warn("Stripe.js@".concat(f," was loaded on the page, but @stripe/stripe-js@").concat("7.5.0"," expected Stripe.js@").concat(y,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var g=a.apply(void 0,b);return F(g,c),g},K=!1,L=function(){return d?d:d=(null!==G?G:(G=new Promise(function(a,b){if("undefined"==typeof window||"undefined"==typeof document)return void a(null);if(window.Stripe,window.Stripe)return void a(window.Stripe);try{var c,d=D();d?d&&null!==I&&null!==H&&(d.removeEventListener("load",I),d.removeEventListener("error",H),null==(c=d.parentNode)||c.removeChild(d),d=E(null)):d=E(null),I=function(){window.Stripe?a(window.Stripe):b(Error("Stripe.js not available"))},H=function(a){b(Error("Failed to load Stripe.js",{cause:a}))},d.addEventListener("load",I),d.addEventListener("error",H)}catch(a){b(a);return}})).catch(function(a){return G=null,Promise.reject(a)})).catch(function(a){return d=null,Promise.reject(a)})};Promise.resolve().then(function(){return L()}).catch(function(a){K||console.warn(a)}),!function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];K=!0;var d=Date.now();L().then(function(a){return J(a,b,d)})}("pk_live_51R0BObJCPXMbmjAynGFkA1rIpcrT0rcdkwEXqpgIRzgBeMbneHWZYOyVEoCp2OAIE918STRO4eKjF44upAmit6Ww00YmkaL7uP");let M={BRL:{name:"Brazilian Real",symbol:"R$",locale:"pt-BR",zeroDecimal:!1},USD:{name:"US Dollar",symbol:"$",locale:"en-US",zeroDecimal:!1},EUR:{name:"Euro",symbol:"â‚¬",locale:"de-DE",zeroDecimal:!1},GBP:{name:"British Pound",symbol:"\xa3",locale:"en-GB",zeroDecimal:!1},CAD:{name:"Canadian Dollar",symbol:"C$",locale:"en-CA",zeroDecimal:!1},AUD:{name:"Australian Dollar",symbol:"A$",locale:"en-AU",zeroDecimal:!1},JPY:{name:"Japanese Yen",symbol:"\xa5",locale:"ja-JP",zeroDecimal:!0},CHF:{name:"Swiss Franc",symbol:"CHF",locale:"de-CH",zeroDecimal:!1},MXN:{name:"Mexican Peso",symbol:"MX$",locale:"es-MX",zeroDecimal:!1},ARS:{name:"Argentine Peso",symbol:"ARS$",locale:"es-AR",zeroDecimal:!1}},N=new w.A(process.env.STRIPE_SECRET_KEY||"",{apiVersion:"2024-12-18.acacia"});async function O(a){try{console.log("Stripe API route called");let b=await a.json();console.log("Request body:",b);let{amount:c,currency:d="brl",isMonthly:e=!1,donationTier:f,country:g}=b;if(!c||c<=0)return v.NextResponse.json({error:"Invalid amount"},{status:400});if(!process.env.STRIPE_SECRET_KEY||"sk_test_your_secret_key_here"===process.env.STRIPE_SECRET_KEY)return console.error("STRIPE_SECRET_KEY not configured"),v.NextResponse.json({error:"Payment system not configured"},{status:500});let h=d.toUpperCase();if(!M[h])return v.NextResponse.json({error:"Unsupported currency"},{status:400});let i=M[h].zeroDecimal?Math.round(c):Math.round(100*c),j=["card"],k={mode:e?"subscription":"payment",payment_method_types:j,success_url:`${a.nextUrl.origin}/support?success=true&session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${a.nextUrl.origin}/support?canceled=true`,allow_promotion_codes:!0,billing_address_collection:"auto",shipping_address_collection:g?{allowed_countries:[g.toUpperCase()]}:void 0,metadata:{donationTier:f||"custom",isMonthly:e.toString(),currency:h,country:g||"unknown"}};e?k.line_items=[{price_data:{currency:h.toLowerCase(),product_data:{name:`Monthly Support - ${f||"Custom Donation"}`,description:"Monthly support for Marcha Brasil civic infrastructure",images:[`${a.nextUrl.origin}/logo-stripe.png`]},unit_amount:i,recurring:{interval:"month"}},quantity:1}]:k.line_items=[{price_data:{currency:h.toLowerCase(),product_data:{name:`One-time Donation - ${f||"Custom Amount"}`,description:"One-time donation to support Marcha Brasil civic infrastructure",images:[`${a.nextUrl.origin}/logo-stripe.png`]},unit_amount:i},quantity:1}],console.log("Creating Stripe session with params:",JSON.stringify(k,null,2));let l=await N.checkout.sessions.create(k);if(console.log("Stripe session created:",l.id),l.id)try{await (0,x.hv)({stripe_session_id:l.id,amount:c,payment_method:"stripe",is_monthly:e,donation_tier:f||"custom",tier_name:f||"Custom Amount",metadata:{stripe_session_id:l.id,amount:c,currency:h,is_monthly:e,country:g||"unknown",payment_methods:j}})}catch(a){console.error("Failed to record donation in database:",a)}return v.NextResponse.json({id:l.id,url:l.url})}catch(a){return console.error("Stripe checkout session creation failed:",a),console.error("Error details:",a.message,a.stack),v.NextResponse.json({error:a.message||"Failed to create checkout session"},{status:500})}}let P=new f.AppRouteRouteModule({definition:{kind:g.RouteKind.APP_ROUTE,page:"/api/create-checkout-session/route",pathname:"/api/create-checkout-session",filename:"route",bundlePath:"app/api/create-checkout-session/route"},distDir:".next",projectDir:"",resolvedPagePath:"/Users/cristianosantos/civic-mobilization/src/app/api/create-checkout-session/route.ts",nextConfigOutput:"",userland:e}),{workAsyncStorage:Q,workUnitAsyncStorage:R,serverHooks:S}=P;function T(){return(0,h.patchFetch)({workAsyncStorage:Q,workUnitAsyncStorage:R})}async function U(a,b,c){var d;let e="/api/create-checkout-session/route";"/index"===e&&(e="/");let f=await P.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!f)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:h,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=f,D=(0,k.normalizeAppPath)(e),E=!!(y.dynamicRoutes[D]||y.routes[C]);if(E&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new t.NoFallbackError}let F=null;!E||P.isDev||x||(F="/index"===(F=C)?"/":F);let G=!0===P.isDev||!E,H=E&&!G,I=a.method||"GET",J=(0,j.getTracer)(),K=J.getActiveScopeSpan(),L={params:v,prerenderManifest:y,renderOpts:{experimental:{dynamicIO:!!w.experimental.dynamicIO,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,i.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:H,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>P.onRequestError(a,b,d,z)},sharedContext:{buildId:h}},M=new l.NodeNextRequest(a),N=new l.NodeNextResponse(b),O=m.NextRequestAdapter.fromNodeNextRequest(M,(0,m.signalFromNodeResponse)(b));try{let d=async c=>P.handle(O,L).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=J.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==n.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${I} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${I} ${a.url}`)}),f=async f=>{var h,j;let k=async({previousCacheEntry:g})=>{try{if(!(0,i.getRequestMeta)(a,"minimalMode")&&A&&B&&!g)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(f);a.fetchMetrics=L.renderOpts.fetchMetrics;let h=L.renderOpts.pendingWaitUntil;h&&c.waitUntil&&(c.waitUntil(h),h=void 0);let j=L.renderOpts.collectedTags;if(!E)return await (0,p.I)(M,N,e,L.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,q.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[s.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=s.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,d=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=s.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:u.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==g?void 0:g.isStale)&&await P.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,o.c)({isRevalidate:H,isOnDemandRevalidate:A})},z),b}},l=await P.handleResponse({req:a,nextConfig:w,cacheKey:F,routeKind:g.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!E)return null;if((null==l||null==(h=l.value)?void 0:h.kind)!==u.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,i.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,q.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,i.getRequestMeta)(a,"minimalMode")&&E||m.delete(s.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,r.getCacheControlHeader)(l.cacheControl)),await (0,p.I)(M,N,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};K?await f(K):await J.withPropagatedContext(a.headers,()=>J.trace(n.BaseServerSpan.handleRequest,{spanName:`${I} ${a.url}`,kind:j.SpanKind.SERVER,attributes:{"http.method":I,"http.target":a.url}},f))}catch(b){if(K||await P.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,o.c)({isRevalidate:H,isOnDemandRevalidate:A})}),E)throw b;return await (0,p.I)(M,N,new Response(null,{status:500})),null}}},27910:a=>{"use strict";a.exports=require("stream")},28354:a=>{"use strict";a.exports=require("util")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:a=>{"use strict";a.exports=require("tls")},39727:()=>{},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:a=>{"use strict";a.exports=require("crypto")},55591:a=>{"use strict";a.exports=require("https")},56621:(a,b,c)=>{"use strict";c.d(b,{EX:()=>i,hv:()=>h});var d=c(66437);let e="https://xjkaqdsldskhlhjptrga.supabase.co",f="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhqa2FxZHNsc2RraGxoanB0cmdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwMTA3MDMsImV4cCI6MjA2ODU4NjcwM30.eJuf7qNjehg1eSg7GB3Tv7xSNdz6phbWKuC8Cci0kFM",g=e&&f&&1?(0,d.UU)(e,f):null,h=async a=>{if(!g)return{data:null,error:{message:"Supabase not configured"}};let{data:b,error:c}=await g.from("donations").insert(a).select().single();return{data:b,error:c}},i=async(a,b,c,d)=>{if(!g)return{data:null,error:{message:"Supabase not configured"}};let e={payment_status:b,updated_at:new Date().toISOString()};c&&(e.stripe_payment_intent_id=c),d&&(e.completed_at=d);let{data:f,error:h}=await g.from("donations").update(e).eq("stripe_session_id",a).select().single();return{data:f,error:h}}},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:a=>{"use strict";a.exports=require("zlib")},78335:()=>{},79428:a=>{"use strict";a.exports=require("buffer")},79551:a=>{"use strict";a.exports=require("url")},79646:a=>{"use strict";a.exports=require("child_process")},81630:a=>{"use strict";a.exports=require("http")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},91645:a=>{"use strict";a.exports=require("net")},94735:a=>{"use strict";a.exports=require("events")},96487:()=>{}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[4985,6055,7877,6437],()=>b(b.s=21016));module.exports=c})();